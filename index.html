<!DOCTYPE html>
<html lang="fa" dir="rtl">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>IUMS 1402 | معدل ترم 3</title>
		<meta name="description" content="بچه‌ها معدل می‌خواستن؛ اینم می‌گیره."/>
		<meta property="og:title" content="معدل ترم 3"/>
		<meta property="og:site_name" content="IUMS Med 1402 Mehr"/>
		<meta property="og:description" content="بچه‌ها معدل می‌خواستن؛ اینم می‌گیره."/>
		<link rel="icon" type="image/x-icon" href="./favicon.ico">
		<meta name="theme-color" content="#715aff">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simpledotcss@latest/simple.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap-grid.rtl.min.css"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700;900&display=swap");
			@import url("https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap");
			@import url("https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400&display=swap");
			:root {
				--accent-bg: #f0eeff;
				--accent: #715aff;
				--preformatted: #333;
				font-family: "Source Sans Pro", "Vazirmatn", var(--sans-font);
			}
			@media (prefers-color-scheme: dark) {
				:root {
					color-scheme: dark;
					--accent-bg: #2b2b2b;
					--accent: #a682ff;
					--preformatted: #ccc;
				}
			}
			body { word-wrap: break-word; }
			code { color: var(--preformatted); font-family: "Source Code Pro", var(--mono-font) }
			header { font-weight: 900; text-align: center; }
			footer { font-weight: 700; text-align: center; }
			.section { margin: 2rem 0; }
			button { font-family: inherit; font-weight: bold; }
			input, select, img, button { width: 100%; }
			input { text-align: center; }
			.row-sm.col-md { margin: 0; }
		</style>
	</head>
	<body>
		<header>
			<nav style="margin-bottom: .5rem;">
				<a href="https://t.me/IUMSClassPlannerBot" target="_blank">ربات پلنر کلاس‌های IUMS (فعلاً خاموش)</a>
			</nav>
			<h1 style="font-weight: 900;">معدل می‌گیره</h1>
			<span>ترم 3 پزشکی IUMS</span>
		</header>
		<main id="courses-div" class="container">
			<!-- Dynamic shit -->
			<!-- This is a message for yall. I didn't do this for any of you, I don't fuck w any of you tbh. Did it and suited it the best for only ONE person. -->
		</main>
		<footer>
			<p dir="rtl">خمیدرضا © کپی رایت چیه؟ بردار استفاده کن</p>
		</footer>
		<script>
			const defaultCourses = [
				{name: "آناتومی گوارش نظری", unit: 1.5, score: 0},
				{name: "آناتومی گوارش عملی", unit: 0.5, score: 0},
				{name: "فیزیولوژی گوارش", unit: 0.6, score: 0},
				{name: "آناتومی ادراری نظری", unit: 0.8, score: 0},
				{name: "آناتومی ادراری عملی", unit: 0.2, score: 0},
				{name: "فیزیولوژی کلیه", unit: 0.7, score: 0},
				{name: "بیوشیمی کلیه", unit: 0.2, score: 0},
				{name: "آناتومی غدد نظری", unit: 0.2, score: 0},
				{name: "آناتومی غدد عملی", unit: 0.2, score: 0},
				{name: "فیزیولوژی غدد", unit: 1.2, score: 0},
				{name: "بیوشیمی هورمون", unit: 0.7, score: 0},
				{name: "باکتری نظری", unit: 2.4, score: 0},
				{name: "باکتری عملی", unit: 0.6, score: 0},
				{name: "ویروس", unit: 1.0, score: 0},
				{name: "فارسی", unit: 3.0, score: 0},
				{name: "زبان تخصصی", unit: 3.0, score: 0},
				{name: "فرهنگ و تمدن", unit: 2.0, score: 0},
				{name: "تربیت بدنی", unit: 1.0, score: 0},
				{name: "فیزیک پزشکی نظری", unit: 1.8, score: 0},
				{name: "فیزیک پزشکی عملی", unit: 0.2, score: 0},
				{name: "دانش خانواده", unit: 2.0, score: 0},
			];

			function renderCourses(courses) {
				const container = document.getElementById("courses-div");
				container.innerHTML = "";
				courses.forEach((course, index) => {
					const div = document.createElement("div");
					div.id = `c${index}-div`; div.className = "row justify-content-space-between section"; div.style = "--bs-gap: .5rem .5rem";
					div.innerHTML = `
						<span style="text-align: left;"><a style="cursor: pointer;" onclick="removeCourse('${index}')">حذف</a></span>
						<div class="row-sm col-md">
							<label id="c${index}-name" onInput="inputNameChange('${index}')" contenteditable>${course.name}</label>
							<input type="number" id="c${index}-score" onInput="inputScoreChange('${index}')" value="${course.score}" min="0" max="20">
						</div>
						<div class="row-sm col-md">
							<label for="c${index}-unit">واحدش:</label>
							<input type="number" id="c${index}-unit" onInput="inputUnitChange('${index}')" value="${course.unit}" min="0" step="0.1" max="4">
						</div>
					`;
					container.appendChild(div);
				});
				const divButtons = document.createElement("div");
				divButtons.id = `buttons-div`; divButtons.className = "row justify-content-space-between section"; divButtons.style = "--bs-gap: .5rem .5rem";
				divButtons.innerHTML = `
					<div class="row-sm col-md">
						<button onclick="addCourse()">افزودن درس</button>
					</div>
					<div class="row-sm col-md">
						<button onclick="resetCourses()">ریست دروس</button>
					</div>
				`;
				container.appendChild(divButtons);
				const divResult = document.createElement("div");
				divResult.id = "result-div"; divResult.className = "row section"; divResult.style = "text-align: center";
				divResult.innerHTML = `
					<span id="result-title">اینم معدلت (0 واحد):</span>
					<h3 id="result">0</h3>
				`;
				container.appendChild(divResult);
			};
			
			function removeCourse(index) {
				courses = JSON.parse(window.localStorage.getItem("courses"));
				courses.splice(Number(index), 1);
				window.localStorage.setItem("courses", JSON.stringify(courses));
				renderCourses(courses);
				updateResult(courses);
			};
			
			function addCourse() {
				courses = JSON.parse(window.localStorage.getItem("courses"));
				courses.push({name: "درس جدید", unit: 0.0, score: 0});
				window.localStorage.setItem("courses", JSON.stringify(courses));
				renderCourses(courses);
				updateResult(courses);
			};
			
			function resetCourses() {
				courses = defaultCourses;
				window.localStorage.setItem("courses", JSON.stringify(courses));
				renderCourses(courses);
				updateResult(courses);
			};
			
			function updateResult(courses) {
				unitSum = 0;
				scoreSum = 0;
				courses.forEach((course, index) => {
					unitSum += course.unit;
					scoreSum += course.score * course.unit;
				});
				unitSum = Math.round(unitSum * 10) / 10;
				document.getElementById("result-title").innerText = `اینم معدلت (${unitSum} واحد):`;
				const scoreMean = scoreSum / unitSum;
				const result = Math.round(scoreMean * 100) / 100;
				document.getElementById("result").innerText = result;
			};
			
			Array.prototype.update = function(args) {
				for (var key in args) {
					this[key] = args[key];
				}
				return this;
			};
			
			function fixDecimal(value, dp){
				return +parseFloat(value).toFixed(dp);
			};

			function inputScoreChange(id) {
				if (Number(document.getElementById(`c${id}-score`).value) > 20) {
					document.getElementById(`c${id}-score`).value = 20;
				} else if (Number(document.getElementById(`c${id}-score`).value) < 0) {
					document.getElementById(`c${id}-score`).value = 0;
				};
				courses = JSON.parse(window.localStorage.getItem("courses"));
				courses[id].score = Number(document.getElementById(`c${id}-score`).value);
				window.localStorage.setItem("courses", JSON.stringify(courses));
				updateResult(courses);
			};
			
			function inputUnitChange(id) {
				if (Number(document.getElementById(`c${id}-unit`).value) > 4) {
					document.getElementById(`c${id}-unit`).value = 4;
				} else if (Number(document.getElementById(`c${id}-unit`).value) < 0) {
					document.getElementById(`c${id}-unit`).value = 0;
				};
				if (document.getElementById(`c${id}-unit`).value.length > 3) {
					document.getElementById(`c${id}-unit`).value = fixDecimal(Number(document.getElementById(`c${id}-unit`).value), 1);
				};
				courses = JSON.parse(window.localStorage.getItem("courses"));
				courses[id].unit = Number(document.getElementById(`c${id}-unit`).value);
				window.localStorage.setItem("courses", JSON.stringify(courses));
				updateResult(courses);
			};
			
			function inputNameChange(id) {
				courses = JSON.parse(window.localStorage.getItem("courses"));
				courses[id].name = document.getElementById(`c${id}-name`).innerText;
				window.localStorage.setItem("courses", JSON.stringify(courses));
			};

			if (localStorage.getItem("courses") === null || (localStorage.getItem("version") === null || localStorage.getItem("version") != "3.0")) {
				window.localStorage.setItem("version", "3.0");
				courses = defaultCourses;
				window.localStorage.setItem("courses", JSON.stringify(courses));
				renderCourses(courses);
				updateResult(courses);
			} else {
				courses = JSON.parse(window.localStorage.getItem("courses"));
				renderCourses(courses);
				updateResult(courses);
			};
		</script>
	</body>
</html>
